3-3- Cơ bản về hình học trong Revit

[Giảng viên] Cho đến nay trong khóa học này, chúng ta đã sử dụng một số loại hình học khác nhau mà Revit API cung cấp, như đối tượng XYZ, đường thẳng và cung tròn. Hãy cùng xem kỹ hơn một số loại hình học khác trong Revit API bằng cách phân tích cấu trúc hình học tạo nên các phần tử khác nhau. Mô hình hình học của một phần tử 3D trong Revit được định nghĩa bởi một đối tượng GeometryElement, đây là biểu diễn hình học của một phần tử. Đối tượng này có thể được lấy từ một phần tử và hoạt động như một danh sách chứa các loại hình học khác tạo nên các phần tử Revit. Những loại hình học này bao gồm khối đặc (solids), lưới (meshes), thể hiện hình học (geometry instances), đường cong (curves), điểm (points) và đa tuyến (polylines). Một số trong số này có thể được chia nhỏ hơn nữa. Các đối tượng khối đặc được tạo thành từ các mặt (faces) và cạnh (edges), còn thể hiện hình học có thể chứa tất cả các loại hình học khác hoặc các thể hiện hình học lồng nhau. Do đó, một thể hiện hình học có thể được lồng nhiều lần. Thể hiện hình học là một phần hình học đại diện cho một tập hợp hình học được lưu trữ, thường được sử dụng cho các thể hiện family, chẳng hạn như một cánh cửa. Nó sẽ được tạo thành từ các yếu tố hình học khác nhau như khung, cánh cửa và tay nắm. 

Để lấy hình học từ một phần tử, chúng ta cần lấy đối tượng GeometryElement từ phần tử đó. Sau đó, chúng ta có thể duyệt hoặc lặp qua GeometryElement như một danh sách. Các đối tượng được lấy từ GeometryElement là các đối tượng hình học (GeometryObject). Đây là lớp cơ sở cho hình học trong Revit. Vì vậy, chúng ta có thể ép kiểu đối tượng này sang loại phù hợp, cho dù đó là mặt, lưới hay thể hiện hình học. Nếu nhận được một thể hiện hình học, chúng ta cần sử dụng phương thức GetInstanceGeometry từ đối tượng GeometryInstance để lấy GeometryElement liên kết của nó. Sau đó, chúng ta cần lặp lại qua nội dung của nó một lần nữa.

Bây giờ, hãy chuyển sang trình duyệt đối tượng (Object Browser) trong Visual Studio để xem cách lấy GeometryElement. Hãy tìm kiếm từ "Element". Chúng ta có thể truy cập hình học của một phần tử bằng cách lấy nó thông qua thuộc tính Geometry trên đối tượng. Thuộc tính này bị quá tải (overloaded) vì nó nhận một tham số, nghĩa là chúng ta cần thêm tiền tố "Get_" khi truy xuất nó. Chúng ta có thể thấy điều này trong các phương thức của lớp Element. Đối với tham số, thuộc tính Geometry yêu cầu một đối tượng Options. Điều này cho phép chúng ta tùy chỉnh kết quả đầu ra nhận được. Hãy chọn lớp Options để xem chi tiết.

Dễ dàng thôi! Chúng ta có thể tạo một đối tượng Options bằng cách sử dụng hàm tạo (constructor). Và các tùy chọn chúng ta có thể thiết lập được hiển thị trong các thuộc tính. ComputeReferences cần được đặt thành true để lấy các đối tượng tham chiếu (reference objects) từ hình học phần tử. Các đối tượng tham chiếu này được yêu cầu bởi một số phương thức Revit API, chẳng hạn như ghi kích thước. DetailLevel là kiểu liệt kê (enum) gồm Coarse, Medium và Fine. Điều này xác định chất lượng của hình học được lấy, nghĩa là Fine có nghĩa là chất lượng cao hơn hoặc nhiều mặt hơn. IncludeNonVisibleObjects có thể được sử dụng để lấy hình học của phần tử bị ẩn. Và View có thể được thiết lập để xác định view mà từ đó hình học được trích xuất, vì một số hình học có thể bị cắt xén.

Khi hình học được trích xuất từ phần tử, nó có thể được sử dụng trong nhiều chức năng khác nhau, chẳng hạn như tính toán vị trí tương đối với các phần tử khác, sử dụng nó để định nghĩa các phần tử khác và tìm hiểu các thuộc tính của nó như diện tích và chiều dài.