4-4- Sheets (Trang)

[Giảng viên] Sau khi chú thích các khung nhìn (views), bước tiếp theo là đặt chúng lên các trang (sheets). Trong Revit API, một Sheet là một loại khung nhìn, chúng ta có thể tạo bằng lớp ViewSheet. Lớp này kế thừa từ lớp View. Giống như các lớp View khác, lớp ViewSheet có thể được tạo bằng phương thức Create trong lớp. Phương thức này chỉ cần nhận tài liệu (document) và ID của phần tử cho loại TitleBlock. Ở đây, chúng ta có thể truyền một ID phần tử không hợp lệ, kết quả là không sử dụng TitleBlock nào. Sau khi tạo một Sheet, chúng ta có thể đặt các khung nhìn khác bằng cách tạo các viewport trên sheet, nhưng chúng ta sẽ tìm hiểu điều đó trong video tiếp theo. Bây giờ, hãy tạo một lệnh mới chỉ đơn giản là tạo một sheet mới.

Hiện tại, tôi đang mở tệp bài tập Visual Studio cho video này. Trong đây, tôi đã tạo một lớp Sheets, là một IExternalCommand mới. Tôi đã truy xuất tài liệu và bắt đầu một giao dịch (transaction) mới. Chúng ta có thể sử dụng cái này để tạo các sheets. Vì vậy, hãy bắt đầu bằng cách tìm TitleBlock mà chúng ta muốn sử dụng. Trong bài tập Revit cho video này, chỉ có một TitleBlock, là mẫu mặc định. Vì vậy, hãy tìm nó trong lệnh của chúng ta bằng cách sử dụng FilteredElementCollector và lấy cái đầu tiên chúng ta gặp, chắc chắn sẽ là cái này. Nếu có nhiều hơn trong dự án, chúng ta có thể tìm chúng bằng tên, như chúng ta đã làm trước đây với các họ (families) khác.

Vì vậy, để tìm mẫu, hãy sử dụng FilteredElementCollector và lấy mẫu dưới dạng FamilySymbol. Bắt đầu bằng cách tạo một biến FamilySymbol tên là tBlock, và sau đó chúng ta sẽ gán cho nó một FilteredElementCollector mới, lọc tài liệu. Sau đó, để tìm TitleBlock trong tài liệu, hãy áp dụng bộ lọc ofCategory, lọc cho BuiltInCategory TitleBlocks. Vì vậy, ofCategory, BuiltInCategory, OST_TitleBlocks. Vì chúng ta muốn một loại (type), hãy thêm bộ lọc WhereElementIsElementType, và sau đó để lấy nó dưới dạng FamilySymbol, hãy sử dụng phương thức Cast, sẽ chuyển đổi thành FamilySymbol, và cuối cùng, để lấy cái đầu tiên, chỉ cần sử dụng phương thức First.

Tuyệt vời, bây giờ chúng ta đã có mẫu TitleBlock mà mình muốn. Hãy tiếp tục và tạo một sheet trong các phương thức Start và Commit của giao dịch. Để làm điều đó, hãy tạo một biến ViewSheet tên là vSheet và gán cho nó một lệnh gọi đến phương thức Create từ lớp ViewSheet. Đối với phương thức này, chúng ta cần tài liệu, là doc, và sau đó là ID của TitleBlock mà chúng ta đã lấy, vì vậy tBlock.Id. Tuyệt vời, vậy là chúng ta đã tạo sheet đầu tiên của mình.

Trước khi thử lệnh, hãy thay đổi một vài thuộc tính trên sheet, chẳng hạn như tên và số sheet. Đối với tên, chúng ta chỉ cần truy cập thuộc tính Name và gán một chuỗi mới cho nó. Tôi sẽ đặt tên là "My First Sheet". Đối với số sheet, chúng ta cũng cần sử dụng một chuỗi, và để làm điều này, chúng ta truy cập thuộc tính SheetNumber. Tôi sẽ đặt tên là "J101", hoàn hảo. Vì vậy, lệnh của chúng ta bây giờ sẽ tạo một sheet và tự động cập nhật tên và số sheet.

Tôi đã thêm cái này vào bản kê khai (manifest), vì vậy hãy gỡ lỗi lệnh bằng cách nhấn nút Start và mở tệp bài tập Revit cho video này. Sau đó, trong tệp dự án của chúng ta, hãy chuyển đến tab Add-Ins, External Tools và chạy lệnh của chúng ta, đó là Sheet. Sau đó, hãy xem trong phần Sheet. Hoàn hảo, có vẻ như sheet của chúng ta đã được tạo và các thuộc tính đã được cập nhật. Chúng ta đã tạo thành công một sheet với một mẫu trực tiếp từ Revit API. Điều này có thể rất hữu ích khi tự động hóa việc tạo sheet. Bước tiếp theo là bắt đầu thêm các khung nhìn.