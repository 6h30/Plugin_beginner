2-9
[Giảng viên] Trong một video trước, chúng ta đã học cách đặt một family bằng cách sử dụng điểm chèn hoặc tọa độ XYZ. Trong video này, hãy cùng xem một cách khác để đặt các phần tử, chẳng hạn như sử dụng các đường thẳng bằng cách tạo tường trực tiếp trong lệnh Revit. Trong file này, tôi đã tạo sẵn một lớp PlaceLineElement, một IExternalCommand mới. Trước khi bắt đầu đặt các bức tường, hãy xem cách tạo một bức tường. Chuyển sang Object Browser và tôi đang duyệt qua Custom Component Set, thư viện tham chiếu đến các file RevitAPI và RevitAPIUI. Trong này, tôi sẽ tìm kiếm "wall" và chọn lớp Wall. Ở đây, bạn có thể thấy Wall có các phương thức tạo trực tiếp trong lớp Wall như các constructor và có một số cách khác nhau để tạo chúng. Hãy sử dụng phương thức này với bốn tham số khác nhau. Phương thức yêu cầu document, một đường cong (curve), một Element ID làm level và một giá trị Boolean để xác định xem nó có phải là kết cấu hay không. Phương thức này sẽ tạo một bức tường bằng cách sử dụng đường cong mà chúng ta cung cấp làm đường trung tâm và kiểu tường mặc định. Chúng ta đã biết cách lấy document và level thông qua bộ lọc FilteredElementCollector, vì vậy hãy xem kỹ hơn lớp Curve. Để xem các loại đường cong khác nhau có thể tạo, chúng ta cần xem các kiểu dẫn xuất của lớp này. Đầu tiên, mở rộng lớp Curve và sau đó là Derived Types. Điều này cho chúng ta thấy một số loại đường cong khác nhau có thể tạo. Hãy sử dụng lớp Line để tạo một đường thẳng bằng phương thức CreateBound, phương thức này nhận hai đối tượng XYZ cho điểm đầu và cuối. Chúng ta cũng thử lớp Arc để tạo một cung tròn bằng cách sử dụng ba đối tượng XYZ: điểm đầu, điểm cuối và điểm giữa. Bây giờ, hãy quay lại lệnh của chúng ta và thử làm điều này. Như bạn có thể thấy, tôi đã tạo sẵn một FilteredElementCollector để tìm level có tên "Ground Floor". Có thể trông hơi khác so với FilteredElementCollector trước đó vì tôi đã áp dụng các phím tắt trực tiếp vào đối tượng FilteredElementCollector và tìm level có tên "Ground Floor". Một điều cần lưu ý ở đây là nếu bộ lọc không tìm thấy level có tên "Ground Floor", nó sẽ gây ra ngoại lệ, vì vậy để an toàn, bạn có thể đặt nó trong một khối try-catch. Bây giờ chúng ta đã có level, hãy bắt đầu tạo các đường cong. Để làm điều đó, chúng ta cần tạo một số đối tượng XYZ để thiết lập chúng. Chúng ta sẽ tạo ba bức tường và một bức tường hình cung ở cuối. Vì vậy, hãy tạo bốn điểm cho các góc và một điểm cho đỉnh của cung tròn. Chúng ta có thể tạo chúng theo chiều kim đồng hồ từ góc dưới bên trái, sau đó sử dụng chúng để thiết lập các đường cong. Để làm điều này, hãy bắt đầu bằng cách tạo năm đối tượng XYZ khác nhau có tên p1, p2, v.v. Sau đó, thay đổi các tham số XYZ cho từng điểm, bắt đầu từ góc dưới bên trái: X là -10, Y là -10 và Z là 0. Đối với điểm thứ hai: X là 10, Y là -10 và Z là 0. Đối với điểm thứ ba (điểm giữa): X là 15, Y và Z là 0. Đối với điểm thứ tư: sử dụng 10, 10 và 0. Và điểm thứ năm: sử dụng -10, 10 và 0. Bây giờ chúng ta có thể sử dụng chúng để tạo các đường cong. Chúng ta cần lưu trữ các đường cong này trong một danh sách, vì vậy hãy tạo một danh sách các đối tượng Curve có tên "Curves". Sau đó, hãy tạo từng đường cong, bắt đầu với một đường thẳng có tên l1. Để tạo đường cong, hãy truy cập phương thức CreateBound từ lớp Line, sau đó sử dụng p1 và p2 cho đường đầu tiên. Đối với cung tròn, hãy gọi nó là l2 và chúng ta cần truy cập phương thức Create từ lớp Arc, sau đó cung cấp điểm đầu, điểm cuối và điểm giữa. Vì vậy, hãy sử dụng p1, p4 và sau đó là p3. Sau đó, tạo một đường thẳng khác bằng cách sử dụng p4 và p5 và chúng ta sẽ gọi nó là l3. Cuối cùng, một đường cong cuối cùng có tên l4 và chúng ta sẽ sử dụng p5 và p1 để đóng các đường cong. Và bây giờ, đối với mỗi đường cong này, chúng ta cần thêm chúng vào danh sách Curves. Chúng ta có thể làm điều này bằng phương thức Add. Tuyệt vời, bây giờ hãy sử dụng chúng và phương thức Wall.Create để tạo các bức tường. Để làm điều đó, chúng ta cần lặp qua từng đường cong trong danh sách và tạo một bức tường. Chúng ta có thể làm điều này bên trong một transaction, vì vậy trong các phương thức Start và Commit, hãy sử dụng vòng lặp foreach cho mỗi đường cong c trong Curves và đối với mỗi đường cong, truy cập phương thức Wall.Create, cung cấp document, đường cong, level.Id và false cho loại kết cấu. Hoàn hảo. Bây giờ hãy thử lệnh này. Tôi đã thêm lệnh này vào manifest. Vì vậy, hãy nhấp vào Start để debug. Sau đó, mở file thực hành Revit cho video này và thử lệnh mới trong tab Add-Ins, chọn PlaceLineElement. Hoàn hảo, đây là các bức tường của chúng ta. Có vẻ như chúng ta đã tạo thành công các phần tử dựa trên đường thẳng một cách tự động. Một điều bạn có thể nhận thấy là chúng ta đã tạo các đường thẳng và cung tròn bên ngoài transaction. Điều này là do chúng không cần được lưu trữ trong dự án và do đó không cần phải commit vào model. Revit được tạo thành từ nhiều phần tử dựa trên đường thẳng, vì vậy điều quan trọng là phải hiểu khi nào nên sử dụng các loại hình học Revit khác nhau để tạo phần tử.