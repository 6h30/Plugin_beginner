2-8
### [Gi·∫£ng vi√™n]  
Tr∆∞·ªõc khi ti·∫øp t·ª•c h·ªçc c√°ch t·∫°o ph·∫ßn t·ª≠, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu c√°ch t·ªëi ∆∞u **FilteredElementCollector** b·∫±ng **LINQ extensions** v√† **lambda expressions** ƒë·ªÉ code ng·∫Øn g·ªçn v√† hi·ªáu qu·∫£ h∆°n.  

### **1. Gi·ªõi thi·ªáu v·ªÅ LINQ v√† Lambda Expressions**  
- **LINQ (Language-Integrated Query)**: M·ªôt t√≠nh nƒÉng c·ªßa C# gi√∫p truy v·∫•n v√† l·ªçc d·ªØ li·ªáu t·ª´ nhi·ªÅu ngu·ªìn kh√°c nhau.  
  - V√≠ d·ª•: `from x in dataSource where x.Property == value select x`  
- **Extension Methods**: C√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông th√™m v√†o ki·ªÉu d·ªØ li·ªáu c√≥ s·∫µn (nh∆∞ `List`, `IEnumerable`).  
  - V√≠ d·ª•: `First()`, `Where()`, `Select()`, `Cast()`.  
- **Lambda Expressions**: H√†m ·∫©n danh (kh√¥ng t√™n), vi·∫øt ng·∫Øn g·ªçn v·ªõi c√∫ ph√°p `x => x.Action`.  
  - V√≠ d·ª•: `x => x.Name == "Desk"`  

> üí° **L∆∞u √Ω**:  
> - ∆Øu ti√™n d√πng **b·ªô l·ªçc Revit (Quick/Slow Filters)** tr∆∞·ªõc khi d√πng LINQ v√¨ ch√∫ng t·ªëi ∆∞u h∆°n.  
> - LINQ ph√π h·ª£p ƒë·ªÉ x·ª≠ l√Ω ph·ª©c t·∫°p sau khi l·ªçc c∆° b·∫£n.  

### **2. T·ªëi ∆∞u FilteredElementCollector b·∫±ng LINQ**  
Trong v√≠ d·ª• tr∆∞·ªõc, ch√∫ng ta d√πng v√≤ng l·∫∑p `foreach` ƒë·ªÉ t√¨m `FamilySymbol`. Gi·ªù h√£y thay th·∫ø b·∫±ng LINQ:  

#### **Code c≈© (d√πng foreach)**  
```csharp
IList<Element> symbols = new FilteredElementCollector(doc)
    .OfClass(typeof(FamilySymbol))
    .WhereElementIsElementType()
    .ToElements();

FamilySymbol targetSymbol = null;
foreach (Element ele in symbols)
{
    if (ele.Name == "1,525 by 762 millimeters")
    {
        targetSymbol = ele as FamilySymbol;
        break;
    }
}
```

#### **Code m·ªõi (d√πng LINQ + Lambda)**  
```csharp
FamilySymbol targetSymbol = new FilteredElementCollector(doc)
    .OfClass(typeof(FamilySymbol))
    .WhereElementIsElementType()
    .Cast<FamilySymbol>() // √âp ki·ªÉu sang FamilySymbol
    .FirstOrDefault(x => x.Name == "1,525 by 762 millimeters");
```

### **3. Gi·∫£i th√≠ch chi ti·∫øt**  
- **`.Cast<FamilySymbol>()`**: Chuy·ªÉn ƒë·ªïi t·∫•t c·∫£ ph·∫ßn t·ª≠ th√†nh ki·ªÉu `FamilySymbol`.  
- **`.FirstOrDefault()`**: L·∫•y ph·∫ßn t·ª≠ **ƒë·∫ßu ti√™n** th·ªèa ƒëi·ªÅu ki·ªán trong lambda.  
  - N·∫øu kh√¥ng t√¨m th·∫•y, tr·∫£ v·ªÅ `null`.  
- **Lambda `x => x.Name == "..."`**: Ki·ªÉm tra t·ª´ng ph·∫ßn t·ª≠ `x` c√≥ t√™n kh·ªõp kh√¥ng.  

### **4. Ki·ªÉm th·ª≠**  
- Ch·∫°y l·ªánh **Debug** v√† th·ª≠ ƒë·∫∑t family trong Revit:  
  ```csharp
  if (targetSymbol != null)
  {
      doc.Create.NewFamilyInstance(
          new XYZ(0, 0, 0),
          targetSymbol,
          StructuralType.NonStructural
      );
  }
  ```
- K·∫øt qu·∫£: Family b√†n s·∫Ω xu·∫•t hi·ªán t·∫°i t·ªça ƒë·ªô (0, 0, 0).  

### **5. L·ª£i √≠ch**  
- **Code ng·∫Øn g·ªçn**: Thay 7 d√≤ng b·∫±ng 1 d√≤ng LINQ.  
- **D·ªÖ ƒë·ªçc**: Logic l·ªçc r√µ r√†ng, kh√¥ng c·∫ßn v√≤ng l·∫∑p th·ªß c√¥ng.  
- **Linh ho·∫°t**: C√≥ th·ªÉ k·∫øt h·ª£p nhi·ªÅu ƒëi·ªÅu ki·ªán ph·ª©c t·∫°p.  

### **6. V√≠ d·ª• m·ªü r·ªông**  
T√¨m t·∫•t c·∫£ family thu·ªôc danh m·ª•c **Furniture**:  
```csharp
var furnitureSymbols = new FilteredElementCollector(doc)
    .OfCategory(BuiltInCategory.OST_Furniture)
    .WhereElementIsElementType()
    .Cast<FamilySymbol>()
    .ToList(); // Chuy·ªÉn th√†nh danh s√°ch
```

### **K·∫øt lu·∫≠n**  
LINQ v√† Lambda Expressions l√† c√¥ng c·ª• m·∫°nh ƒë·ªÉ t·ªëi ∆∞u h√≥a **FilteredElementCollector**, gi√∫p code Revit API **s·∫°ch h∆°n, nhanh h∆°n**. Ch√∫ng ta s·∫Ω ti·∫øp t·ª•c √°p d·ª•ng ch√∫ng trong c√°c b√†i t·∫≠p ti·∫øp theo! üöÄ

---
[Gi·∫£ng vi√™n] Tr∆∞·ªõc khi ti·∫øp t·ª•c h·ªçc c√°ch t·∫°o c√°c th√†nh ph·∫ßn, t√¥i mu·ªën xem l·∫°i b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠ ƒë·ªÉ h·ªçc c√°ch l√†m cho ch√∫ng ng·∫Øn g·ªçn h∆°n th√¥ng qua c√°c ph·∫ßn m·ªü r·ªông LINQ v√† bi·ªÉu th·ª©c lambda. N·∫øu b·∫°n ch∆∞a t·ª´ng s·ª≠ d·ª•ng LINQ (Language-Integrated Query) tr∆∞·ªõc ƒë√¢y, ƒë∆°n gi·∫£n ƒë√¢y l√† m·ªôt t√≠nh nƒÉng c·ªßa C# cho ph√©p ch√∫ng ta truy v·∫•n c√°c ngu·ªìn d·ªØ li·ªáu kh√°c nhau v√† l·ªçc k·∫øt qu·∫£. Vi·ªác n√†y ƒë∆∞·ª£c th·ª±c hi·ªán b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c to√°n t·ª≠ truy v·∫•n nh∆∞ from, where v√† select. V√≠ d·ª•: from x in dataSource where x b·∫±ng m·ªôt h√†m n√†o ƒë√≥, select x. N√≥ cho ph√©p ch√∫ng ta l·ªçc qua c√°c ngu·ªìn d·ªØ li·ªáu b·∫±ng c√°c h√†m kh√°c nhau.  

M·∫∑c d√π ch√∫ng ta s·∫Ω kh√¥ng t·∫°o c√°c truy v·∫•n LINQ trong video n√†y, nh∆∞ng ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng c√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ. Ph∆∞∆°ng th·ª©c m·ªü r·ªông l√† c√°c ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c th√™m v√†o m·ªôt ki·ªÉu ƒë·ªëi t∆∞·ª£ng ƒë√£ t·ªìn t·∫°i. C√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ cho ph√©p ch√∫ng ta th√™m ch·ª©c nƒÉng truy v·∫•n v√†o c√°c ki·ªÉu IEnumerable trong C# nh∆∞ danh s√°ch (List) ho·∫∑c b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠. C√°c ph·∫ßn m·ªü r·ªông n√†y bao g·ªìm nhi·ªÅu ph∆∞∆°ng th·ª©c kh√°c nhau, ch·∫≥ng h·∫°n nh∆∞ First() ƒë·ªÉ l·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n trong danh s√°ch, Select() ƒë·ªÉ ch·ªçn c√°c ph·∫ßn t·ª≠ t·ª´ danh s√°ch d·ª±a tr√™n m·ªôt h√†m, ho·∫∑c Cast(), cho ph√©p ch√∫ng ta chuy·ªÉn ƒë·ªïi ki·ªÉu (cast) m·ªçi ph·∫ßn t·ª≠ trong danh s√°ch sang m·ªôt ki·ªÉu c·ª• th·ªÉ. Nh·ªù ƒë√≥, ch√∫ng c√≥ th·ªÉ gi√∫p ch√∫ng ta s·∫Øp x·∫øp v√† l·∫•y ch√≠nh x√°c c√°c ph·∫ßn t·ª≠ mong mu·ªën t·ª´ m·ªôt b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠.  

Tuy nhi√™n, h√£y nh·ªõ r·∫±ng c√°c b·ªô l·ªçc nhanh (quick filters) v√† ch·∫≠m (slow filters) m√† ch√∫ng ta ƒë√£ √°p d·ª•ng l√† c√°c b·ªô l·ªçc ri√™ng, v√† ch√∫ng ta n√™n c·ªë g·∫Øng s·ª≠ d·ª•ng ch√∫ng c√†ng nhi·ªÅu c√†ng t·ªët tr∆∞·ªõc khi √°p d·ª•ng c√°c ph∆∞∆°ng th·ª©c LINQ, v√¨ c√°c b·ªô l·ªçc g·ªëc s·∫Ω nhanh h∆°n.  

K·∫øt h·ª£p ph∆∞∆°ng th·ª©c m·ªü r·ªông v·ªõi bi·ªÉu th·ª©c lambda mang l·∫°i cho ch√∫ng ta nhi·ªÅu ch·ª©c nƒÉng h∆°n n·ªØa ƒë·ªëi v·ªõi b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠. Bi·ªÉu th·ª©c lambda l√† c√°c h√†m ·∫©n danh (anonymous functions), t·ª©c l√† m·ªôt ph∆∞∆°ng th·ª©c kh√¥ng c√≥ t√™n v√† c√≥ th·ªÉ ƒë∆∞·ª£c vi·∫øt d∆∞·ªõi d·∫°ng c√¢u l·ªánh n·ªôi tuy·∫øn (inline), v√≠ d·ª• nh∆∞ b√™n trong m·ªôt ph∆∞∆°ng th·ª©c m·ªü r·ªông Select().  

ƒê·ªÉ vi·∫øt m·ªôt bi·ªÉu th·ª©c lambda, ch√∫ng ta c·∫ßn s·ª≠ d·ª•ng to√°n t·ª≠ `=>`. ·ªû b√™n tr√°i, ch√∫ng ta c√≥ th·ªÉ ch√®n m·ªôt bi·∫øn s·∫Ω l√† tham s·ªë duy nh·∫•t cho h√†m, v√† ·ªü b√™n ph·∫£i, ch√∫ng ta ch√®n l·ªánh g·ªçi h√†m. V√≠ d·ª•: `x => x == 2`. Bi·ªÉu th·ª©c n√†y s·∫Ω ki·ªÉm tra t·ª´ng ph·∫ßn t·ª≠ trong danh s√°ch xem n√≥ c√≥ b·∫±ng 2 hay kh√¥ng v√† tr·∫£ v·ªÅ true ho·∫∑c false. ƒêi·ªÅu n√†y c√≥ th·ªÉ ƒë∆∞·ª£c √°p d·ª•ng cho m·ªôt ki·ªÉu IEnumerable v√† n√≥ s·∫Ω tr·∫£ v·ªÅ m·ªôt danh s√°ch IEnumerable c·ªßa c√°c k·∫øt qu·∫£.  

B√¢y gi·ªù, h√£y c√πng chuy·ªÉn sang Visual Studio v√† th·ª≠ s·ª≠ d·ª•ng c√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ c√πng bi·ªÉu th·ª©c lambda ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a m·ªôt b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠. Hi·ªán t·∫°i, t√¥i ƒëang m·ªü t·ªáp d·ª± √°n Visual Studio t·ª´ n∆°i ch√∫ng ta d·ª´ng l·∫°i ·ªü video tr∆∞·ªõc. ·ªû ƒë√¢y, ch√∫ng ta ƒë√£ s·ª≠ d·ª•ng m·ªôt b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠ ƒë·ªÉ thu th·∫≠p t·∫•t c·∫£ c√°c FamilySymbol trong m·ªôt t·ªáp d·ª± √°n v√† t√¨m m·ªôt th·ªÉ hi·ªán c·ª• th·ªÉ. H√£y s·ª≠ d·ª•ng c√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a vi·ªác n√†y.  

Thay v√¨ thu th·∫≠p t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ v√† sau ƒë√≥ l·∫∑p qua ch√∫ng, h√£y th√™m v√≤ng l·∫∑p n√†y tr·ª±c ti·∫øp v√†o b·ªô l·ªçc c·ªßa ch√∫ng ta. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, tr∆∞·ªõc ti√™n h√£y x√≥a ph∆∞∆°ng th·ª©c `ToList()`, v√† ti·∫øp theo, h√£y ƒë·∫∑t ƒëi·ªÅu ki·ªán `WhereElementIsElementType` ·ªü d√≤ng ti·∫øp theo, v√¨ ch√∫ng ta s·∫Ω √°p d·ª•ng m·ªôt s·ªë ph∆∞∆°ng th·ª©c kh√°c nhau.  

ƒê·ªÉ b·∫Øt ƒë·∫ßu, h√£y chuy·ªÉn ƒë·ªïi t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ sang m·ªôt ki·ªÉu c·ª• th·ªÉ ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ thao t√°c tr√™n ch√∫ng. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, h√£y th√™m ph∆∞∆°ng th·ª©c `Cast<FamilySymbol>()`. Ti·∫øp theo, h√£y s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `First()` ƒë·ªÉ √°p d·ª•ng m·ªôt h√†m cho m·ªói FamilySymbol trong danh s√°ch. ƒê·ªëi v·ªõi ƒëi·ªÅu ki·ªán, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt bi·ªÉu th·ª©c lambda trong ngo·∫∑c ƒë∆°n. ƒêi·ªÅu ki·ªán n√†y s·∫Ω th·ª±c hi·ªán ch·ª©c nƒÉng t∆∞∆°ng t·ª± nh∆∞ v√≤ng l·∫∑p `foreach` c·ªßa ch√∫ng ta tr∆∞·ªõc ƒë√¢y.  

ƒê·ªÉ sao ch√©p l·∫°i ƒëi·ªÅu ƒë√≥, h√£y b·∫Øt ƒë·∫ßu v·ªõi m·ªôt bi·∫øn, ch·∫≥ng h·∫°n `x`. Bi·∫øn n√†y s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng cho m·ªçi ph·∫ßn t·ª≠ trong danh s√°ch, theo sau l√† to√°n t·ª≠ lambda (`=>`), v√† sau ƒë√≥ l√† h√†nh ƒë·ªông √°p d·ª•ng cho t·ª´ng ph·∫ßn t·ª≠. H√£y sao ch√©p ƒëi·ªÅu ki·ªán ki·ªÉm tra m√† ch√∫ng ta ƒë√£ th·ª±c hi·ªán ·ªü d√≤ng 33 trong c√¢u l·ªánh `if` v√† thay th·∫ø `ele` b·∫±ng `x`.  

V√¨ ch√∫ng ta ƒëang l·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n (ch·ªâ m·ªôt ph·∫ßn t·ª≠), ch√∫ng ta kh√¥ng c·∫ßn ph·∫£i l·∫•y n√≥ d∆∞·ªõi d·∫°ng danh s√°ch, v√¨ v·∫≠y h√£y thay th·∫ø `List<FamilySymbol>` b·∫±ng `FamilySymbol` v√† ƒë·ªïi t√™n `symbols` th√†nh `symbol`. Sau ƒë√≥, ch√∫ng ta c√≥ th·ªÉ x√≥a v√≤ng l·∫∑p `foreach` m√† ch√∫ng ta ƒë√£ t·∫°o trong video tr∆∞·ªõc.  

Tuy·ªát v·ªùi! Thay v√¨ thu th·∫≠p t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ trong m·ªôt danh s√°ch v√† l·∫∑p qua t·ª´ng ph·∫ßn t·ª≠, ch√∫ng ta ƒëang s·ª≠ d·ª•ng c√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ v√† bi·ªÉu th·ª©c lambda ƒë·ªÉ th·ª±c hi·ªán v√≤ng l·∫∑p tr·ª±c ti·∫øp trong b·ªô l·ªçc c·ªßa m√¨nh. H√£y nh·∫•n Debug ƒë·ªÉ xem n√≥ c√≥ ho·∫°t ƒë·ªông kh√¥ng v√† m·ªü t·ªáp Revit b√†i t·∫≠p li√™n quan ƒë·∫øn video n√†y.  

H√£y th·ª≠ ch·∫°y l·∫°i l·ªánh c·ªßa ch√∫ng ta: **Place Family**. Ho√†n h·∫£o, Family c·ªßa ch√∫ng ta ƒë√£ xu·∫•t hi·ªán!  

C√°c ph∆∞∆°ng th·ª©c m·ªü r·ªông LINQ v√† bi·ªÉu th·ª©c lambda r·∫•t h·ªØu √≠ch ƒë·ªÉ l√†m cho m√£ c·ªßa ch√∫ng ta ng·∫Øn g·ªçn v√† d·ªÖ ƒë·ªçc h∆°n. Trong ph·∫ßn c√≤n l·∫°i c·ªßa kh√≥a h·ªçc, ch√∫ng ta s·∫Ω th·ª≠ c√°c c√°ch kh√°c nhau ƒë·ªÉ √°p d·ª•ng ch√∫ng v√†o c√°c b·ªô l·ªçc thu th·∫≠p ph·∫ßn t·ª≠.