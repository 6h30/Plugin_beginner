4-5- Đặt các khung nhìn

[Giảng viên] Trong phần này, chúng ta đã học cách tạo khung nhìn, chú thích chúng và tạo bản vẽ. Bước cuối cùng là học cách đặt một khung nhìn lên bản vẽ. Các khung nhìn được hiển thị trên bản vẽ thông qua đối tượng viewport. Lớp viewport khác với các khung nhìn mà chúng ta đã xem xét ở chỗ nó không thực sự là một khung nhìn. Nó kế thừa từ lớp phần tử và chỉ được sử dụng để đặt các khung nhìn lên bản vẽ. Điều này có thể được thực hiện bằng cách sử dụng phương thức create trong lớp. Phương thức này sẽ tạo một viewport mới tại một vị trí nhất định. Các tham số cần thiết là tài liệu, ID bản vẽ mà khung nhìn sẽ được đặt lên, ID khung nhìn cần hiển thị và một đối tượng XYZ cho vị trí của nó. Sau khi tạo viewport, chúng ta có thể truy cập các thuộc tính và phương thức liên quan đến đối tượng viewport. Vì vậy, hãy thử sử dụng phương pháp này trong một lệnh mới để đặt viewport vào trung tâm của bản vẽ. Hiện tại, tôi đang mở tệp bài tập Visual Studio cho video này. Ở đây, tôi đã tạo một lớp PlaceView, một IExternalCommand mới. Trong này, tôi đã lấy tài liệu và thiết lập hai bộ lọc phần tử, một để lấy bản vẽ mà chúng ta đã tạo trong video trước đó và một để lấy khung nhìn đã tạo trước đó. Sau đó, tôi thiết lập một giao dịch để tạo viewport. Đầu tiên, chúng ta cần lấy trung tâm của bản vẽ. Để làm điều đó, chúng ta có thể truy xuất đường viền của bản vẽ bằng cách truy cập thuộc tính outline của nó. Điều này sẽ trả về một đối tượng BoundingBoxUV. Đối tượng này về cơ bản là một hình chữ nhật 2D bao quanh một đối tượng, trong trường hợp này là bản vẽ. Hình chữ nhật được xác định bởi các hướng U và V. Tại điểm giao nhau, chúng ta có thể xác định các tham số U, V. Hãy coi chúng như tọa độ X, Y trên mặt phẳng 2D. Vì vậy, bằng cách lấy đường viền này, chúng ta có thể lấy tọa độ U, V tối đa và tối thiểu. Chúng có thể được truy cập thông qua hai thuộc tính của đối tượng outline. Từ đó, chúng ta có thể xác định điểm giữa giữa hai tọa độ này. Điều này được thực hiện bằng công thức giá trị U tối đa cộng với giá trị U tối thiểu chia cho hai, tạo ra giá trị X cho tọa độ XYZ, sau đó chúng ta cộng giá trị V tối đa với giá trị V tối thiểu chia cho hai để tạo ra tọa độ Y của điểm giữa. Sau đó, chúng ta có thể sử dụng điểm giữa này để đặt khung nhìn. Vì vậy, hãy bắt đầu bằng cách lấy đối tượng BoundingBoxUV. Để làm điều này, hãy tạo một biến BoundingBoxUV và đặt tên là outline. Sau đó, gán cho nó bounding box bằng cách truy cập thuộc tính outline từ bản vẽ đã thu thập. Vì vậy, vSheet.Outline. Bây giờ chúng ta có thể truy cập các tọa độ U, V tối đa và tối thiểu. Hãy sử dụng chúng để tạo các biến X và Y điều khiển đối tượng XYZ. Để làm điều đó, hãy bắt đầu bằng cách lấy tọa độ X bằng cách tạo một biến double tên là x và gán cho nó giá trị U, V tối đa bằng cách truy cập outline.Max.U, sau đó cộng với giá trị outline.Min.U và chia kết quả cho hai. Hoàn hảo. Tiếp theo, làm tương tự cho giá trị Y bằng cách tạo một biến double tên là Y và gán cho nó giá trị outline.Max.V cộng với outline.Min.U và chia kết quả cho hai. Tuyệt vời. Bây giờ chúng ta có các biến X và Y. Chúng ta có thể sử dụng chúng để tạo một đối tượng XYZ mới. Vì vậy, hãy tạo một đối tượng mới và gọi nó là midPoint, một XYZ mới sử dụng biến x và y cho các tham số x và y và zero cho z. Hoàn hảo, bây giờ chúng ta đã có vị trí để đặt viewport, hãy thực hiện trong giao dịch. Để làm điều này, hãy tạo một biến viewport tên là viewport và gán cho nó lệnh gọi phương thức create từ lớp viewport, lấy bản vẽ đã thu thập, vSheet.Id, sau đó là khung nhìn cần đặt, trong trường hợp này là vPlan.Id và midPoint của chúng ta. Tuyệt vời, chúng ta đã lấy điểm giữa của bản vẽ và sử dụng nó để tạo viewport tại vị trí đó. Hãy thử lệnh này. Tôi đã thêm lệnh này vào tệp manifest. Vì vậy, hãy nhấn Start để gỡ lỗi lệnh. Và bạn có thể thấy rằng chúng ta nhận được một lỗi là biến x không thể được sử dụng vì nó đang được sử dụng trong các biểu thức lambda, vì vậy hãy đổi nó thành xu và yu. Tuyệt vời, sau đó nhấn Start. Sau đó mở tệp bài tập Revit cho video này. Trong tệp này, chúng ta có bản vẽ đã tạo trong video trước và trong phần View, chúng ta có mặt bằng đã tạo trước đó. Vì vậy, hãy chạy lệnh mới của chúng ta có tên là PlaceView. Hoàn hảo, bạn có thể thấy rằng chúng ta đã đặt viewport ở trung tâm của bản vẽ như dự định. Khả năng truy cập bản vẽ và đặt khung nhìn thông qua Revit API mang lại tiềm năng lớn để tự động hóa các tác vụ. Tuy nhiên, một điều cần lưu ý là đảm bảo khung nhìn đủ điều kiện để đặt trước khi thực hiện, vì một số khung nhìn như bảng biểu không thể đặt bằng lớp viewport. Cách tốt nhất để làm điều đó là sử dụng phương thức canAddViewToSheet từ lớp viewport.