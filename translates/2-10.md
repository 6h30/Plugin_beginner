2-10
[Giảng viên] Bất kỳ phần tử Revit nào được tạo bằng vòng kín trong chế độ phác thảo, chẳng hạn như sàn và mái, đều được tạo bằng các loại Revit chứa tập hợp các đường cong, chẳng hạn như vòng lặp đường cong và mảng đường cong trong API. Vì vậy, hãy cùng xem cách tạo một sàn mới trong Revit bằng cách sử dụng các loại này. Trong tệp này, tôi đã tạo lớp phần tử vòng lặp địa điểm, một lệnh I-external mới. Đây là phần tiếp theo của bài tập trước, nơi chúng ta sử dụng các đường cong để tạo một số bức tường. Bây giờ hãy sử dụng chúng để tạo một sàn mới. Trong trình duyệt đối tượng, hãy tìm kiếm "new floor". Có ba phương pháp khác nhau để tạo sàn. Bạn có thể thắc mắc tại sao những phương pháp này không nằm trong lớp Floor. Đây là một điểm đặc biệt trong Revit API khi một số phương pháp tạo nằm trong không gian tên Creation.Document từ khi phiên bản Revit API đầu tiên được phát hành. Hãy sử dụng phương pháp đơn giản này, yêu cầu một mảng đường cong và một giá trị boolean để tạo sàn. Một mảng đường cong đơn giản là một lớp tập hợp của Revit chứa các đường cong. Nó cho phép chúng ta thêm các đường cong vào một danh sách tổng thể. Nhưng chỉ vậy thôi. Hãy xem lớp CurveLoop. Đây là một kiểu tập hợp khác của Revit hoạt động như một danh sách các đường cong. Không giống như mảng đường cong, CurveLoop yêu cầu các đường cong phải được sắp xếp tuần tự và cho phép chúng ta tạo chúng theo nhiều cách khác nhau, chẳng hạn như offset. Phương pháp này yêu cầu một CurveLoop để offset, một khoảng cách và một mặt phẳng vuông góc để offset từ đó. Vì vậy, hãy sử dụng phương pháp này để tạo một CurveLoop offset từ đường trung tâm của tường để sàn bằng phẳng với tường bên ngoài và sau đó chuyển đổi nó thành một mảng đường cong để tạo sàn. Điều đầu tiên chúng ta cần làm là tạo một CurveLoop bằng cách sử dụng các đường cong từ bài tập trước và sau đó tạo CurveLoop offset. Hãy bắt đầu bằng cách tạo một biến CurveLoop có tên là crvLoop. Sau đó gán cho nó một CurveLoop mới bằng cách truy cập phương thức tạo tĩnh từ lớp CurveLoop. Phương thức này nhận một danh sách các đường cong, mà chúng ta hiện có là curves. Tiếp theo, hãy offset CurveLoop này. Để làm điều đó, chúng ta cần một khoảng cách offset. Trong bài tập trước, chúng ta đã tạo các bức tường bằng loại mặc định. Đây có vẻ là tường cơ bản, gạch đôi 270. Vì vậy, hãy nhập cứng một offset là 135 mm. Tuy nhiên, Revit API làm việc với đơn vị feet, vì vậy chúng ta cần chuyển đổi số này. Để làm điều này, chúng ta có thể sử dụng lớp UnitUtils. Đầu tiên, tạo một biến double có tên là offset và gán cho nó một lệnh gọi đến ConvertToInternalUnits từ lớp UnitUtils. Sau đó sử dụng 135 làm tham số đầu tiên và thứ hai là loại đơn vị. Đây là một kiểu liệt kê. Gọi DisplayUnitType, sẽ là DUT_MILLIMETERS. Vì vậy, điều này sẽ chuyển đổi đơn vị milimét của chúng ta thành feet. Bây giờ chúng ta có thể offset CurveLoop, tạo một biến CurveLoop khác có tên là offsetCurve và gán cho nó một CurveLoop mới bằng cách truy cập phương thức CreateViaOffset từ lớp CurveLoop. Và chúng ta sẽ cung cấp CurveLoop, khoảng cách offset sẽ là offset và normal. Về cơ bản, đây sẽ là hướng lên hoặc một vectơ trên trục Z. Trong Revit API, đối tượng XYZ cũng là một vectơ. Vì vậy, hãy tạo một XYZ mới với 1 cho tham số Z. Tuyệt vời, bây giờ chúng ta đã có CurveLoop offset. Bây giờ hãy chuyển đổi nó thành một mảng đường cong bằng cách tạo một mảng đường cong mới có tên là cArray. Sau đó, để gán từng đường cong từ CurveLoop, chúng ta có thể duyệt qua nó như một danh sách. Vì vậy, hãy bắt đầu một vòng lặp foreach, lặp qua từng đường cong bằng biến c trong offsetCurves. Và với mỗi vòng lặp, hãy sử dụng phương thức Append để thêm đường cong vào mảng đường cong. Hoàn hảo, bây giờ chúng ta đã có các thành phần để tạo một sàn. Bên trong giao dịch, hãy gọi phương thức NewFloor từ lớp Document.Creation, sử dụng mảng đường cong và false cho non-structural. Tôi đã chuẩn bị sẵn điều này trong bản kê khai. Vì vậy, hãy thử nghiệm nó. Nhấn Debug và sau đó mở tệp bài tập Revit cho video này. Và trong mặt bằng tầng trệt, hãy thử lệnh mới, PlaceLoopElement. Không có lỗi nào nên có vẻ như nó đã hoạt động. Hãy chuyển sang chế độ xem 3D. Hoàn hảo, đó là sàn mới của chúng ta. Nếu bạn muốn phát triển lệnh này hơn nữa, bạn có thể thử lọc chế độ xem để tìm các bức tường đã được đặt trong chế độ xem để xác định khoảng cách offset cho CurveLoop thay vì nhập cứng giá trị. Bạn thậm chí có thể tự động phát hiện loại đơn vị từ đối tượng đơn vị trong tài liệu.