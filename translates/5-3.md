5-3. Tùy chỉnh giao diện người dùng

[Giảng viên] Bây giờ chúng ta đã triển khai giao diện IExternalApplication, hãy bắt đầu tùy chỉnh giao diện người dùng. Hiện tại tôi đang mở tệp bài tập Visual Studio cho video này. Đây là phần chúng ta đã dừng lại từ video trước. Chúng ta đã triển khai các phương thức OnShutdown và OnStartup. Tuy nhiên, cả hai phương thức hiện đang phát sinh ngoại lệ. Vì vậy, hãy bắt đầu bằng cách sửa chữa chúng.

Phương thức OnShutdown sẽ được gọi khi Revit tắt. Vì chúng ta không thực sự cần bất kỳ hành động nào trong sự kiện này, hãy chỉ cần trả về kết quả thành công. Vì vậy, return Result.Succeeded.

Trong phương thức OnStartup là nơi chúng ta có thể tạo một phần tử ribbon mới. Vì vậy, hãy bắt đầu bằng cách loại bỏ ngoại lệ và thêm phần tử ribbon mới. Để làm điều đó, chúng ta cần truy cập đối tượng UIControlledApplication được truyền vào phương thức khi Revit khởi động. Vì vậy, hãy truy cập application, và sau đó từ đây chúng ta có thể thêm một tab bằng cách sử dụng phương thức CreateRibbonTab. Phương thức này chỉ cần một chuỗi cho tên của tab mới. Tôi sẽ đặt tên cho tab của mình là "My Commands".

Tuyệt vời, vậy đó là tất cả những gì cần làm để tạo panel mới trong giao diện người dùng. Hãy làm cho nó thú vị hơn một chút bằng cách thêm một nút bấm. Để làm điều đó, trước tiên chúng ta cần tạo một nút bấm bằng cách sử dụng lớp PushButtonData có phương thức SingleConstructor. Vì vậy, hãy tạo một biến PushButtonData có tên là button và chúng ta sẽ gán cho nó một đối tượng PushButtonData mới.

Đối tượng này nhận các tham số chuỗi. Đó là tên của nút, tên văn bản hiển thị cho nút, assembly chứa lệnh nút và tên lớp cho nút. Điều này có nghĩa là chúng ta có thể kết nối nút với các lệnh bên ngoài mà chúng ta đã tạo. Thay vì đặt chúng trong menu công cụ bên ngoài, chúng có thể được đặt trong tab mới của chúng ta.

Vì vậy, hãy thêm một nút sẽ thực thi lệnh PlaceFamily mà chúng ta đã tạo trong video trước đó. Hãy bắt đầu với tên nút. Tôi sẽ đơn giản gọi nó là "Button1". Tiếp theo, chúng ta cần tên hiển thị cho nút. Hãy làm cho nó thú vị hơn một chút. Tôi sẽ đặt tên là "PlaceFamily". Sau đó, chúng ta cần assembly. Đây là tệp .dll từ đó lệnh của chúng ta sẽ được thực thi. Trong trường hợp của chúng ta, đây là cùng một assembly mà chúng ta đang thực thi phương thức này. Vì vậy, chúng ta có thể truy cập assembly đang thực thi bằng cách truy cập phương thức GetExecutingAssembly từ lớp assembly được tìm thấy trong không gian tên System.Reflection.

Vì vậy, ở đầu, hãy thêm using System.Reflection. Bây giờ, trước khi nút của chúng ta được tạo, hãy tạo một biến chuỗi mới có tên là path và chúng ta sẽ gán cho nó một lệnh gọi đến GetExecutingAssembly từ lớp assembly. Phương thức này trả về một đối tượng assembly. Để lấy đường dẫn tệp, chúng ta cần truy cập thuộc tính location. Tuyệt vời.

Bây giờ hãy sử dụng biến path này trong phương thức khởi tạo PushButtonData của chúng ta. Sau "PlaceFamily", hãy thêm path. Tiếp theo, chúng ta cần tên lớp đầy đủ cho lệnh đang thực thi. Vì vậy, hãy sử dụng MyRevitCommands.PlaceFamily. Vì điều này cần phải là một chuỗi, hãy đặt nó trong dấu ngoặc kép. Hoàn hảo.

Bây giờ chúng ta đã có nút của mình, tiếp theo chúng ta cần thêm nó vào một panel sẽ được đặt bên trong tab. Panel đơn giản là một nhóm lệnh. Để tạo một panel, hãy bắt đầu với một biến RibbonPanel có tên là panel và chúng ta sẽ gán cho nó một lệnh gọi đến phương thức CreateRibbonPanel từ UIControlledApplication. Vì vậy, application.CreateRibbonPanel. Tiếp theo, đối với phương thức khởi tạo, hãy sử dụng phương thức nhận một chuỗi cho tên tab và một chuỗi cho tên panel mới. Vì vậy, nó sẽ là "My Commands" cho tab, còn panel, chúng ta sẽ gọi nó là "Commands".

Bây giờ chúng ta có thể đơn giản thêm nút của mình vào panel bằng cách sử dụng phương thức AddItem từ đối tượng panel. Vì vậy, trên một dòng mới, hãy truy cập panel.AddItem. Phương thức này yêu cầu một đối tượng RibbonItemData mà PushButtonData của chúng ta có vì nó kế thừa lớp RibbonItemData. Vì vậy, hãy thêm button. Tuyệt vời, vậy bây giờ chúng ta đã tạo một ribbon, chúng ta đã thêm một panel vào ribbon đó và sau đó chúng ta đã thêm nút của mình vào panel đó.

Cuối cùng, chúng ta chỉ cần trả về kết quả từ phương thức của mình. Vì vậy, hãy return Result.Succeeded. Tuyệt vời. Vì chúng ta đã viết điều này vào tệp kê khai, hãy bấm Start để thử tab mới của chúng ta. Mở tệp bài tập Revit cho video này. Vì vậy, bạn có thể thấy tab mới của chúng ta, nếu chúng ta nhấp vào đó, chúng ta có lệnh PlaceFamily mới. Hãy chuyển đến bản vẽ tầng trệt và thử lệnh. Tuyệt vời, vì vậy nút của chúng ta đang thực thi lệnh mà chúng ta đã tạo trước đó.

Thêm lệnh vào các nút là một cách sạch sẽ hơn để nhóm các lệnh tùy chỉnh và thực thi chúng. Vì chúng ta đang tham chiếu lệnh thông qua ứng dụng, chúng ta không cần thêm nó dưới dạng lệnh vào tệp kê khai. Vì vậy, bạn có thể tưởng tượng việc chỉ cần thêm một mục vào tệp kê khai sẽ dễ dàng hơn bao nhiêu.