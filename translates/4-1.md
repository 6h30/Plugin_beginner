4-1- Views (Giao diện)

[Người dẫn] Revit API cung cấp nhiều cách khác nhau để tạo, chỉnh sửa và điền dữ liệu vào các phần tử, một số trong đó chúng ta đã khám phá trong khóa học này. Bây giờ, hãy xem các cách khác nhau để hiển thị và chú thích các phần tử bằng cách tự động tạo giao diện, gắn thẻ phần tử và tạo bản vẽ. Có một số loại phần tử giao diện khác nhau trong Revit API, tất cả đều kế thừa từ lớp View. Đó là các lớp View3d, ViewDrafting, ViewPlan, ViewSection và ViewSheet. Bạn có thể đoán rằng các lớp này được sử dụng để tạo giao diện 3D, bản vẽ kỹ thuật, mặt bằng, mặt cắt và bản vẽ tương ứng. Có một số cách khác nhau để phân biệt các giao diện ngoài loại lớp của chúng. Các giao diện cũng có thuộc tính ViewType trả về một loại liệt kê. Thuộc tính này mô tả loại giao diện đó. Ví dụ: FloorPlan (Mặt bằng), Elevation (Mặt đứng) hoặc Detail (Chi tiết). Hoặc chúng ta có thể phân biệt bằng loại họ giao diện (view family type), là loại họ được sử dụng để tạo giao diện. Ví dụ: điều này có thể được truy xuất bằng phương thức get type ID từ đối tượng view. Vì vậy, trong video này, hãy tạo một lệnh đơn giản cho phép chúng ta tự động tạo một giao diện mặt bằng. Nhìn vào lớp ViewPlan trong trình duyệt đối tượng, chúng ta có thể thấy rằng chúng ta có thể tạo một giao diện mặt bằng bằng cách truy cập phương thức tĩnh create từ lớp ViewPlan. Phương thức này nhận document (tài liệu), viewFamilyTypeId và levelId làm tham số. Sau đó, nó sẽ trả về một đối tượng ViewPlan mà chúng ta có thể sử dụng để truy cập và chỉnh sửa các thuộc tính của giao diện. Hiện tại, tôi đang mở tệp bài tập Visual Studio cho video này. Ở đây, tôi đã tạo một lớp PlanView, mà tôi đã sử dụng để tạo một IExternalCommand. Trong lệnh này, tôi đã truy xuất document, mà chúng ta có thể sử dụng trong phương thức của mình, sau đó tôi đã truy xuất một level (tầng), là tầng trệt, mà chúng ta cũng có thể sử dụng trong phương thức của mình, và sau đó bắt đầu một giao dịch mới. Đây là nơi chúng ta có thể commit giao diện mặt bằng của mình vào mô hình. Vì chúng ta đã có document và level, hãy bắt đầu bằng cách truy xuất một loại họ giao diện (view family type) mà chúng ta có thể sử dụng để tạo giao diện mặt bằng. Một cách để làm điều này là lọc document cho tất cả các lớp ViewFamilyType, và sau đó tìm một lớp có thuộc tính ViewFamily là FloorPlan. Vì vậy, hãy thử điều đó bằng cách bắt đầu với một biến ViewFamilyType có tên viewFamily. Và sau đó, chúng ta sẽ gán cho biến này một FilteredElementCollector mới, lọc document. Chúng ta có thể tìm các ViewFamilyType bằng cách lọc theo lớp, và chúng ta có thể làm điều này bằng cách sử dụng phím tắt ofClass. Hãy truy cập điều này trực tiếp từ FilteredElementCollector mà chúng ta vừa tạo. Và cho tham số, chúng ta sẽ sử dụng typeof ViewFamilyType. Tiếp theo, hãy chuyển đổi các phần tử được truy xuất thành ViewFamilyType, để chúng ta có thể truy cập các thuộc tính. Vì vậy, chuyển đổi ViewFamilyType, và sau đó mở ngoặc đóng ngoặc. Vì chúng ta thường không có loại ViewPlan cụ thể, hãy chỉ truy xuất phần tử đầu tiên mà chúng ta có thể lấy từ bộ lọc này. Và để làm điều đó, hãy tiếp tục với phương thức First. Trong các tham số của phương thức First, chúng ta có thể viết một biểu thức lambda để lọc tất cả các phần tử để tìm một phần tử có thuộc tính ViewFamily là FloorPlan. Vì vậy, hãy thêm tham số X của chúng ta, sau đó lambda, và chúng ta muốn kiểm tra xem X.ViewFamily có bằng ViewFamily.FloorPlan hay không. Tuyệt vời, vì vậy điều này sẽ lọc ra loại ViewFamilyType đầu tiên có thuộc tính ViewFamily bằng FloorPlan. Tiếp theo, tôi đã truy xuất level. Chúng ta cần ID của level để xác định giao diện mặt bằng sẽ được lấy từ tầng nào. Vì vậy, ở đây tôi chỉ thu thập tầng trệt. Vì chúng ta có tất cả các thành phần để tạo một ViewPlan, hãy tiếp tục và làm điều đó giữa các phương thức Start và Commit trong giao dịch. Vì vậy, sau dòng comment "create view", hãy tạo một biến ViewPlan có tên vPlan. Và chúng ta sẽ gán cho biến đó một lời gọi đến phương thức Create từ lớp ViewPlan. Đối với các tham số, hãy sử dụng document của chúng ta, ID ViewFamilyType của chúng ta và ID level của chúng ta. Hoàn hảo, vì vậy đó là ViewPlan của chúng ta. Để đánh dấu mặt bằng mới của chúng ta, hãy đổi tên nó. Bây giờ chúng ta có thể làm điều này bằng cách truy cập thuộc tính Name của ViewPlan. Vì vậy, ở dòng tiếp theo, hãy truy cập vPlan.Name và gán cho nó: "Our first plan!" (Mặt bằng đầu tiên của chúng ta!). Hoàn hảo. Tôi đã thêm lệnh này vào tệp manifest. Vì vậy, hãy tiếp tục và kiểm tra nó bằng cách nhấn nút debug. Và sau đó mở tệp bài tập Revit cho video này, và sau đó hãy thử lệnh mới của chúng ta. Từ External Tools, và sau đó PlanView. Hoàn hảo. Có vẻ như mặt bằng mới của chúng ta đã được tạo, dựa trên mặt bằng tầng trệt. Tự động tạo mặt bằng từ API có thể rất hữu ích cho việc tạo hàng loạt mặt bằng, chẳng hạn.