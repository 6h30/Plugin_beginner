3-4- Duyệt qua hình học (Traversing geometry)

[Giảng viên] Bây giờ chúng ta đã biết cách lấy hình học từ một phần tử, hãy thử trích xuất các mặt của bức tường và tính tổng diện tích của nó. Hiện tại tôi đang mở tệp bài tập Visual Studio cho video này. Ở đây, tôi đã tạo lớp SelectGeometry là một lệnh IExternalCommand mới. Lệnh này cho phép chúng ta chọn một đối tượng và sau đó lấy phần tử đó. Vì vậy, bên trong câu lệnh if này, hãy trích xuất các mặt của tường và sau đó tính tổng diện tích và số lượng mặt của nó. Để bắt đầu, hãy tạo đối tượng tùy chọn mà chúng ta có thể sử dụng để chỉ định cách hình học được xuất ra. Vì vậy, hãy tạo một biến tùy chọn có tên gOptions và chúng ta sẽ gán cho nó một đối tượng tùy chọn mới bằng cách sử dụng hàm tạo không có tham số. Tuyệt. Bây giờ hãy đặt mức độ chi tiết của các tùy chọn bằng cách truy cập thuộc tính chi tiết từ đối tượng tùy chọn và đặt nó thành một enum ViewDetailLevel mới là Fine. Điều này có nghĩa là hình học sẽ được chi tiết nhất có thể. Với đối tượng tùy chọn này, bây giờ chúng ta có thể lấy hình học từ phần tử đã chọn bằng cách truy cập thuộc tính hình học của nó. Vì vậy, hãy tạo một biến phần tử hình học có tên geom và gán cho nó một lệnh gọi đến thuộc tính hình học bằng cách sử dụng gOptions làm tham số. Tuyệt vời, vì vậy bây giờ chúng ta đã lấy được phần tử hình học, chúng ta có thể bắt đầu duyệt qua các đối tượng hình học được chứa bên trong. Để làm điều đó, hãy tạo một vòng lặp foreach cho mỗi đối tượng hình học như gObj trong geom và bên trong vòng lặp này, điều đầu tiên chúng ta cần làm là ép kiểu đối tượng hình học thành một loại hình học vì chúng ta sẽ chọn một bức tường là một khối rắn, chúng ta có thể ép kiểu nó thành Solid. Vì vậy, hãy tạo một biến Solid có tên gSolid và gán cho nó gObj dưới dạng Solid. Để làm cho điều này an toàn hơn một chút, bạn có thể kiểm tra xem gObj có null không và nếu có, hãy ép kiểu thành một loại khác cho đến khi tìm thấy loại chính xác. Tuy nhiên, chúng ta biết rằng chúng ta sẽ chọn một bức tường cho lệnh này. Vì vậy, hãy làm cho nó dễ dàng. Từ Solid này, chúng ta có thể lấy các mặt và tính diện tích cho từng mặt. Tuy nhiên, trước khi làm điều đó, hãy tạo một biến int có tên faces bằng 0. Chúng ta có thể sử dụng cái này để đếm số lượng mặt. Sau đó, hãy tạo một biến double có tên area bằng 0.0. Chúng ta có thể sử dụng cái này để tính tổng diện tích của các mặt. Bây giờ hãy xem xét từng mặt của Solid và lấy diện tích. Để làm điều đó, chúng ta có thể sử dụng một vòng lặp foreach khác sẽ là cho face như gface trong gSolid. Và bạn có thể thấy chúng ta có một lỗi ở đây vì chúng ta đang cố gắng lặp qua một Solid. Chúng ta cần truy cập các mặt của Solid và để làm điều đó, chúng ta có thể truy cập thuộc tính faces. Điều này trả về một mảng face là một kiểu Revit và về cơ bản là một danh sách các mặt. Chúng ta có thể lấy diện tích của mỗi mặt bằng cách truy cập thuộc tính area của nó. Vì vậy, sử dụng biến area của chúng ta, hãy thêm vào giá trị area hiện tại bằng cách sử dụng dấu cộng bằng và thêm vào đó gface.Area truy cập thuộc tính area của mặt và hãy tăng faces lên một bằng cách sử dụng toán tử cộng cộng. Hoàn hảo. Bây giờ chúng ta có thể hiển thị các giá trị. Tuy nhiên, như chúng ta đã biết, chúng sẽ được hiển thị dưới dạng feet vuông vì feet là loại đơn vị cơ bản trong Revit. Vì vậy, hãy gán lại biến area đảm bảo thực hiện điều này bên ngoài vòng lặp foreach và chúng ta sẽ gán lại nó thành chuyển đổi sang mét vuông bằng cách sử dụng lớp unitutils. Từ đây chúng ta có thể sử dụng convertFromInternalUnits. Vì vậy, hãy chọn cái đó và sử dụng các tham số area và loại đơn vị hiển thị chúng ta muốn chuyển đổi thành là mét vuông sẽ là DUT_SQUARE_METERS. Hoàn hảo, vì vậy bây giờ chúng ta có diện tích tính bằng mét vuông. Hãy tiếp tục và hiển thị điều đó lại cho người dùng. Để làm điều đó, hãy sử dụng TaskDialog. Gọi phương thức show và chúng ta sẽ gọi nó là geometry. Để hiển thị cả hai giá trị của chúng ta, hãy sử dụng phương thức định dạng chuỗi định dạng chuỗi Number of Faces và sau đó là đối số đầu tiên, sau đó hãy thêm một dòng mới vào TaskDialog truy cập thuộc tính Environment.NewLine và chúng ta sẽ thêm vào dòng mới này Total Area và đối số thứ hai của chúng ta. Và cuối cùng, đối với các tham số cho chuỗi được định dạng của chúng ta, hãy sử dụng faces và area. Tuyệt vời, hãy xem nếu điều đó hoạt động. Tôi đã tiếp tục và thêm nó vào bảng kê khai, vì vậy hãy tiếp tục và nhấn debug. Và sau đó mở tệp bài tập Revit cho video này và Add-ins, External Tools, hãy chọn lệnh SelectGeometry và kiểm tra nó trên một bức tường. Hoàn hảo, vì vậy bạn có thể thấy rằng chúng ta có sáu mặt với tổng diện tích là 51,9 mét vuông.