kịch bản video hướng dẫn từng bước — trình bày dạng video tutorial có thoại, từng bước rõ ràng, kết hợp phần hình ảnh minh họa , với nội dung sau: 
3-4-
Traversing geometry
Selecting transcript lines in this section will navigate to timestamp in the video
- [Instructor] Now that we know how to retrieve geometry from an element, let's try to extract the faces of a wall and calculate its total area. I've currently got the Visual Studio exercise file open for this video. In here I've created the class SelectGeometry which is a new IExternalCommand. This command allows us to select an object and then retrieves an element. So, inside of this if statement, let's extract the faces of a wall and then calculate its total area and number of faces. To start, let's create the options object that we can use to specify how the geometry is output. So, let's create an options variable named gOptions and we'll assign to this a new options object using the constructor with no parameters. Great. Now let's hit the detail level of the options by accessing the detail level property from the options object and setting it to a new ViewDetailLevel enum of Fine. This means the geometry will be as detailed as possible. With this option object, we can now retrieve the geometry from the selected element by accessing its geometry property. So, let's create a geometry element variable named geom and assign to this a call to the geometry property using the gOptions as the parameter. Great, so now that we've retrieved the geometry element, we can start traversing the geometry objects contained inside. To do that, let's create a foreach loop for each geometry object as gObj in geom and inside this loop, the first thing we need to do is cast the geometry object as a type of geometry as we'll be selecting a wall which is a solid, we can cast it as solid. So, let's create a solid variable named gSolid and assign to this gObj as Solid. To make this a little bit safer, you could check if gObj is null and if so, cast as another type until the correct one is found. However, we know we'll be selecting a wall for this command. So, let's make it easy. From this solid, we can retrieve the faces and calculate the area for each one. Before we do, however, let's create an int variable named faces which equals zero. We can use this to count the number of faces. Then let's create a double variable named area which equals 0.0. We can use this to add up the total area of the faces. Now let's look over each of the faces of the solid and get the areas. To do that, we can use another foreach loop which will be for face as gface in gSolid. And you can see we have an error here because we're trying to loop over a solid. We need to access the faces of the solid and to do that, we can access the faces property. This returns a face array which is is a Revit type and essentially is a list of faces. We can retrieve the area of each face by accessing its area property. So, using our variable area, let's add to the current area value using the plus equals sign and add to that gface.Area accessing the area property of the face and let's increment faces by one using the plus plus operator. Perfect. Now we can display the values. However, as we've learned, they'll be displayed as square feet as feet is the underlying unit type in Revit. So, let's reassign the area variable making sure to do this outside of the foreach loop and we'll reassign it to a conversion to square meters using the unitutils class. From here we can use the convertFromInternalUnits. So, let's select that and use the parameters area and the display unit type we want to convert to is square meters which will be DUT_SQUARE_METERS. Perfect, so now we have the area in square meters. Let's go ahead and display that back to the user. To do that, let's use a TaskDialog. Calling the show method and we'll call it geometry. To display both of our values, let's use a string format method formatting the string Number of Faces and then the first argument, then let's add a new line to the TaskDialog accessing the Environment.NewLine property and we'll add to this on the new line Total Area and our second argument. And finally, for the parameters for our formatted string, let's use faces and area. Great, let's see if that works. I've already gone ahead and added it into the manifest, so go ahead and hit debug. And then open up the Revit exercise file for this video and the Add-ins, External Tools, let's select the SelectGeometry command and test it on a wall. Perfect, so you can see that we have six faces with a total area of 51.9 square meters.